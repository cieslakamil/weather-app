<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="chart.js"></script>
    <title>Document</title>
    <style>
      .forecast__tile {
        background-color: rgb(228, 210, 210);
        min-height: 300px;
        padding: 20px;
        text-align: center;
      }
      .forecast-container {
        display: grid;
        grid-gap: 10px;
        grid-template-columns: 1fr;
        width: 400px;
      }
      * {
        box-sizing: border-box;
      }
    </style>
  </head>

  <body>
    <h1>Weather forecast</h1>
    <select id="forecast-days" name="Forecast menu">
      <option value="0">Today</option>
      <option value="1">Tomorrow</option>
      <option id="forecast-day-3" value="2"></option>
      <option id="forecast-day-4" value="3"></option>
      <option id="forecast-day-5" value="4"></option>
      <option id="forecast-day-6" value="5"></option>
      <option id="forecast-day-7" value="6"></option>
    </select>
    <!-- Not used -->
    <select id="forecast-hours" name="Forecast menu">
      <option id="forecast-day-23" value="1">0 AM</option>
      <option id="forecast-day-23" value="2">1 AM</option>
      <option id="forecast-day-23" value="2">2 AM</option>
      <option id="forecast-day-23" value="2">3 AM</option>
      <option id="forecast-day-23" value="2">4 AM</option>
      <option id="forecast-day-23" value="2">5 AM</option>
      <option id="forecast-day-23" value="2">6 AM</option>
      <option id="forecast-day-23" value="2">7 AM</option>
      <option id="forecast-day-23" value="2">8 AM</option>
      <option id="forecast-day-23" value="2">9 AM</option>
      <option id="forecast-day-23" value="2">10 AM</option>
      <option id="forecast-day-23" value="2">1 PM</option>
      <option id="forecast-day-23" value="2">2 PM</option>
      <option id="forecast-day-23" value="2">3 PM</option>
      <option id="forecast-day-23" value="2">4 PM</option>
      <option id="forecast-day-23" value="2">5 AM</option>
      <option id="forecast-day-23" value="2">6 PM</option>
      <option id="forecast-day-23" value="2">7 PM</option>
      <option id="forecast-day-23" value="2">8 PM</option>
      <option id="forecast-day-23" value="2">9 PM</option>
      <option id="forecast-day-23" value="2">10 PM</option>
      <option id="forecast-day-23" value="2">11 PM</option>
    </select>
    <!-- <input type="button" value="Get a Forecast" onclick="getForecast()" /> -->
    <div class="forecast-container">
      <div id="forecast__tile-1" class="forecast__tile">
        <img
          id="forecast-icon"
          src="http://openweathermap.org/img/wn/10d@2x.png"
          alt="Forecast icon"
        />
        <hr />
        <span id="forecast-temp"></span><br />
        <span id="forecast-pressure"></span><br />
        <span id="forecast-wind-speed"></span> <br />
        <span id="forecast-humidity"></span>
      </div>
      <canvas id="forecast-hourly-chart" width="400" height="200"></canvas>
    </div>

    <script>
      // https://openweathermap.org/api/one-call-api
      // daily, forecast for 7 days
      // API key: fbc7ccb8414c8df84a06d4997ac35fdd
      // Krak처w
      // lat: 50.0647
      // lon: 19.9450
      // lang = pl
      // API call: https://api.openweathermap.org/data/2.5/onecall?lat=50.0647&lon=19.9450&lang=pl&appid=fbc7ccb8414c8df84a06d4997ac35fdd
      // temperature in Kelvin (K - 273.15 = C)

      fillForecastMenu()
      // Get the forecast of a current today
      getForecast(0)

      let onChange = function (event) {
        let menuDaysState = this.value
        // Get the forecast of a current day
        getForecast(menuDaysState)
      }

      const input = document.getElementById('forecast-days')
      //   Record a state of the menu
      input.addEventListener('input', onChange, false)

      function fillForecastMenu() {
        const date = new Date()

        //   0 - Sun; 6 - Sat
        const weekdayNum = date.getDay()
        const weekday = Array(7)
        weekday[0] = 'Sunday'
        weekday[1] = 'Monday'
        weekday[2] = 'Tuesday'
        weekday[3] = 'Wednesday'
        weekday[4] = 'Thursday'
        weekday[5] = 'Friday'
        weekday[6] = 'Saturday'

        // First - Today; Second - Tomorrow
        for (let i = 0; i < 5; i++) {
          document.getElementById(`forecast-day-${i + 3}`).innerHTML =
            weekday[i + 1]
        }
      }

      async function getForecast(menuDaysState, menuHoursState) {
        const response = await fetch(
          'https://api.openweathermap.org/data/2.5/onecall?lat=50.0647&lon=19.9450&lang=pl&appid=fbc7ccb8414c8df84a06d4997ac35fdd'
        )
        const data = await response.json()
        console.log(data)

        const KELVIN = 273.15
        const dayAccess = data.daily[menuDaysState]

        const temp = (dayAccess.temp.day - KELVIN).toFixed(2)
        const iconURL = `http://openweathermap.org/img/wn/${dayAccess.weather[0].icon}@2x.png`
        const iconAlt = dayAccess.weather[0].description

        document.getElementById('forecast-temp').innerHTML = temp + '째C'
        document.getElementById('forecast-icon').src = iconURL
        document.getElementById('forecast-icon').alt = iconAlt
        document.getElementById('forecast-pressure').innerHTML =
          dayAccess.pressure + ' hPa'
        document.getElementById('forecast-humidity').innerHTML =
          dayAccess.humidity + '%'
        document.getElementById('forecast-wind-speed').innerHTML =
          dayAccess.wind_speed + ' mph'

        // If the day is TODAY
        if (menuDaysState == 0) {
          document.getElementById('forecast-hourly-chart').style.visibility =
            'visible'
          const hourAccess = data.hourly
          const hoursX = []
          const tempsY = []
          for (let i = 0; i < 24; i++) {
            tempsY.push((hourAccess[i].temp - KELVIN).toFixed(2))
            hoursX.push(i)
          }
          createChart(hoursX, tempsY)
        } else {
          document.getElementById('forecast-hourly-chart').style.visibility =
            'hidden'
        }
      }

      function createChart(hoursX, tempsY) {
        const ctx = document
          .getElementById('forecast-hourly-chart')
          .getContext('2d')
        const myChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: hoursX,
            datasets: [
              {
                label: 'Temperature [째C]',
                data: tempsY,
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1,
              },
            ],
          },
          //   options: {
          //     scales: {
          //       yAxes: [
          //         {
          //           ticks: {
          //             beginAtZero: true,
          //           },
          //         },
          //       ],
          //     },
          options: {
            scales: {
              yAxes: [
                {
                  ticks: {
                    callback: function (value, index, values) {
                      return value + '째C'
                    },
                  },
                },
              ],
            },
          },
        })
      }
    </script>
  </body>
</html>
