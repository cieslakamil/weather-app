<!DOCTYPE html>
<html>
  <head>
    <title>Map</title>

    <style type="text/css">
      /* Set the size of the div element that contains the map */
      #map {
        height: 400px;
        width: 800px;
      }
    </style>
        <script>
		var latitude = null;
		var longitude = null;
		let marker
    var city_name = null
		
     // Initialize and add the map
	function initMap(position) {
        const geocoder = new google.maps.Geocoder();
        // The location of User
        const user = { lat: 50.064651, lng: 19.944981 };
        // The map, centered at User
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 10,
          center: user,
        });
		
		marker = new google.maps.Marker({
				draggable: true,
				animation: google.maps.Animation.DROP,
				position: user,
				map: map,
				});
				
		google.maps.event.addListener(marker, "dragstart", function (ev) {
			marker.setAnimation(3); // raise
		});
	
		google.maps.event.addListener(marker, 'dragend', function(ev){
			marker.setAnimation(4); // fall
			latitude = marker.getPosition().lat();
			longitude = marker.getPosition().lng();
			console.log(latitude+'   '+longitude);
            geocodeLatLng(geocoder, map)
		});
		
		
		infoWindow = new google.maps.InfoWindow();
        window.addEventListener("load", () => {
          // Try HTML5 geolocation.
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              (position) => {
                const pos = {
                  lat: position.coords.latitude,
                  lng: position.coords.longitude,
                };
                infoWindow.open(map);
                map.setCenter(pos);
				latitude = position.coords.latitude;
				longitude = position.coords.longitude;
				console.log(latitude+'   '+longitude);
				marker.setPosition(pos)
                geocodeLatLng(geocoder, map)
              },
              () => {
                handleLocationError(true, infoWindow, map.getCenter());
              }
            );
          } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
          }
        });
      }	  
	  
      function geocodeLatLng(geocoder, map) {  //reverse geocoding
        const latlng = {                //coordinates
          lat: parseFloat(latitude),
          lng: parseFloat(longitude),
        };
        geocoder.geocode({ location: latlng }, (results, status) => {
          if (status === "OK") {
            if (results[0]) {
                if (results[0].address_components[2].types[0]=="locality"){      
                    city_name = results[0].address_components[2].long_name        //large city name
                    console.log(city_name);
                } else{
                    city_name = results[0].address_components[1].long_name        //small city name
                    console.log(city_name);
                }
              
            } else {
              console.log("No results found");
            }
          } else {
            conslole.log("Geocoder failed due to: " + status);
          }
        });
      }

    </script>
	
  </head>
  <body>
    <!--The div element for the map -->
    <div id="map"></div>
    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCuaCF5f_8RVyuJjZxr5O9xWSX8VKGan5E&callback=initMap&libraries=&v=weekly"
      async
    ></script>
  </body>
</html>